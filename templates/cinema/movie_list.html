{% extends 'base.html' %}
{% block content %}
<h1>–°–ø–∏—Å–æ–∫ —Ñ–∏–ª—å–º–æ–≤</h1>

<form method="get">
    <input type="text" name="q" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é" value="{{ request.GET.q }}">
    
    <select name="genre">
        <option value="">–í—Å–µ –∂–∞–Ω—Ä—ã</option>
        <option value="horror" {% if request.GET.genre =='horror' %}selected{% endif %}>–£–∂–∞—Å—ã</option>
        <option value="melodrama" {% if request.GET.genre =='boevik' %}selected{% endif %}>–ë–æ–µ–≤–∏–∫</option>
    </select>

    <select name="sort">
        <option value="">–ë–µ–∑ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏</option>
        <option value="date" {% if request.GET.sort =='date' %}selected{% endif %}>–°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ</option>
        <option value="rating" {% if request.GET.sort =='rating' %}selected{% endif %}>–ü–æ —Ä–µ–π—Ç–∏–Ω–≥—É</option>
    </select>

    <button type="submit">–ü–æ–∏—Å–∫</button>
</form>

{% if user.is_authenticated %}
  <p><a href="{% url 'movie-add' %}">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å–º</a></p>
{% endif %}

<ul>
  {% for movie in movies %}
    <li>
      <strong>{{ movie.title }}</strong> ({{ movie.genre }}) ‚Äî {{ movie.rating }} ‚òÖ
      <a href="{% url 'movie-detail' movie.pk %}">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>

      {% if user == movie.author %}
        | <a href="{% url 'movie-edit' movie.pk %}">‚úèÔ∏è</a>
        <a href="{% url 'movie-delete' movie.pk %}">üóëÔ∏è</a>
      {% endif %}
    </li>
  {% empty %}
    <li>–ù–µ—Ç —Ñ–∏–ª—å–º–æ–≤</li>
  {% endfor %}
</ul>

<div>
  {% if is_paginated %}
    <div>
      {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}{{ request.GET.urlencode|cut:'page=' }}">‚Üê –ù–∞–∑–∞–¥</a>
      {% endif %}
      <span>–°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}</span>
      {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}{{ request.GET.urlencode|cut:'page=' }}">–í–ø–µ—Ä—ë–¥ ‚Üí</a>
      {% endif %}
    </div>
  {% endif %}
</div>
{% endblock %}
